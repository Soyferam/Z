<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ø—Ä–µ–º–∏—É–º-–ø–æ–¥–∞—Ä–æ–∫</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
        }
        .gift-container {
            position: relative;
            text-align: center;
        }
        .gift-emoji {
            font-size: 10rem;
            display: inline-block;
            animation: float 4s ease-in-out infinite;
            text-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform-origin: center bottom;
        }
        .gift-text {
            margin-top: 20px;
            font-size: 1.5rem;
            color: #333;
            opacity: 0;
            animation: fadeIn 2s forwards 1s;
        }
        .debug-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8rem;
            max-width: 300px;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(-10px) rotate(-5deg); }
            75% { transform: translateY(-15px) rotate(3deg); }
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        .premium-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #f7d200, #f78d00);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(247, 141, 0, 0.3);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="gift-container">
        <div id="premium-badge" class="premium-badge" style="display: none;">PREMIUM</div>
        <div class="gift-emoji" id="gift-display">üéÅ</div>
        <div class="gift-text" id="gift-text">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—à–µ–≥–æ –ø–æ–¥–∞—Ä–∫–∞...</div>
    </div>

    <div class="debug-info" id="debug-info"></div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const DEBUG_MODE = true;
        const FALLBACK_EMOJI = "üéÅ";
        const BOT_TOKEN = "7902719549:AAGq_hRtJb3WOFMJ7QtDIbkZaKPOG_64eds"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const giftDisplay = document.getElementById('gift-display');
        const giftText = document.getElementById('gift-text');
        const premiumBadge = document.getElementById('premium-badge');
        const debugInfo = document.getElementById('debug-info');
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function logDebug(message) {
            if (DEBUG_MODE) {
                debugInfo.innerHTML += `${new Date().toLocaleTimeString()}: ${message}<br>`;
                console.log(message);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
        function setGift(emoji, isPremium = false) {
            giftDisplay.textContent = emoji;
            giftText.textContent = isPremium ? "–í–∞—à –ø—Ä–µ–º–∏—É–º-–ø–æ–¥–∞—Ä–æ–∫" : "–í–∞—à –ø–æ–¥–∞—Ä–æ–∫";
            premiumBadge.style.display = isPremium ? "block" : "none";
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–æ–±—É—é –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –ø—Ä–µ–º–∏—É–º-–ø–æ–¥–∞—Ä–∫–æ–≤
            if (isPremium) {
                giftDisplay.style.animation = "float 3s ease-in-out infinite, glow 2s ease-in-out infinite alternate";
                document.head.insertAdjacentHTML('beforeend', `
                    <style>
                        @keyframes glow {
                            from { text-shadow: 0 0 5px rgba(255,215,0,0.5); }
                            to { text-shadow: 0 0 20px rgba(255,215,0,0.9), 0 0 30px rgba(255,255,255,0.8); }
                        }
                    </style>
                `);
            }
            
            logDebug(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–¥–∞—Ä–æ–∫: ${emoji} (${isPremium ? '–ø—Ä–µ–º–∏—É–º' : '–æ–±—ã—á–Ω—ã–π'})`);
        }
        
        // 1. –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –∏–∑ Telegram WebApp
        async function tryGetTelegramGift() {
            if (!window.Telegram?.WebApp) {
                logDebug("Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω");
                return null;
            }
            
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            const user = Telegram.WebApp.initDataUnsafe?.user;
            if (!user) {
                logDebug("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã");
                return null;
            }
            
            logDebug(`–û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram: ${user.username || user.id}`);
            
            // –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –ø—Ä–µ–º–∏—É–º
            if (user.is_premium) {
                premiumBadge.style.display = "block";
                
                // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —ç–º–æ–¥–∑–∏ —Å—Ç–∞—Ç—É—Å–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
                if (user.premium_emoji_status?.emoji_id) {
                    const emoji = convertEmojiId(user.premium_emoji_status.emoji_id);
                    logDebug(`–ù–∞–π–¥–µ–Ω –ø—Ä–µ–º–∏—É–º-—ç–º–æ–¥–∑–∏: ${emoji}`);
                    return { emoji, isPremium: true };
                }
                
                // –ï—Å–ª–∏ –Ω–µ—Ç —ç–º–æ–¥–∑–∏ —Å—Ç–∞—Ç—É—Å–∞, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ Bot API
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUserProfilePhotos?user_id=${user.id}`);
                    const data = await response.json();
                    
                    if (data.result?.photos?.length > 0) {
                        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–µ–º–∏—É–º-—ç–º–æ–¥–∑–∏
                        // –≠—Ç–æ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞, —Ç—Ä–µ–±—É—é—â–∞—è –±—ç–∫–µ–Ω–¥–∞
                        logDebug("–ù–∞–π–¥–µ–Ω—ã —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è (–Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)");
                    }
                } catch (e) {
                    logDebug(`–û—à–∏–±–∫–∞ Bot API: ${e.message}`);
                }
            }
            
            return null;
        }
        
        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞
        function checkLocalStorageGift() {
            const savedGift = localStorage.getItem('customGift');
            if (savedGift) {
                logDebug(`–ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫: ${savedGift}`);
                return { emoji: savedGift, isPremium: false };
            }
            return null;
        }
        
        // 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function setDefaultGift() {
            logDebug("–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥–∞—Ä–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é");
            return { emoji: FALLBACK_EMOJI, isPremium: false };
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä ID —ç–º–æ–¥–∑–∏ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π)
        function convertEmojiId(id) {
            const emojiMap = {
                "1": "üåü", "2": "üíé", "3": "‚ú®", "4": "üéÅ",
                "5": "üëë", "6": "üíç", "7": "üèÜ", "8": "üí∞"
            };
            return emojiMap[id] || FALLBACK_EMOJI;
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        async function init() {
            logDebug("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∞—Ç–∞");
            
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
            const telegramGift = await tryGetTelegramGift();
            const localGift = checkLocalStorageGift();
            
            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
            const finalGift = telegramGift || localGift || setDefaultGift();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫
            setGift(finalGift.emoji, finalGift.isPremium);
            
            logDebug("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        init();
    </script>
</body>
</html>